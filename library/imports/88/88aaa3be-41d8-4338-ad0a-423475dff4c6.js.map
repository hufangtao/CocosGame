{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\common\\persist/assets\\scripts\\app\\common\\persist\\GamePersist.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\common\\persist","sourcesContent":["//console.log('GamePersist-loading');\r\nimport * as Defines from \"../Defines\";\r\nimport * as ModuleManagerUtil from \"../../module/ModuleManager\";\r\nimport AccManager from \"../../component/page/login/AccManager\";\r\nimport * as ProtoDispatcher from \"../net/proto/ProtoDispatcher\";\r\nimport NetController from \"../net/NetController\";\r\nimport Toast from \"../../component/prefab/Toast\";\r\nimport { IRootUI, IPanel } from \"../Misc\";\r\nimport SocialManager from \"../social/SocialManager\";\r\nimport RuntimeManager from \"../runtime/RuntimeManager\";\r\nimport { PlayerShareGameC2S, PlayerWatchAdC2S } from \"../net/proto/mods/ProtoSectionPlayer\";\r\nimport NetUtil from \"../net/NetUtil\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GamePersist extends cc.Component {\r\n  public static ToastPool: cc.NodePool = new cc.NodePool();\r\n  public static PlaySplashPool: cc.NodePool = new cc.NodePool();\r\n\r\n  public static get INSTANCE() {\r\n    return GamePersist.singleInstance;\r\n  }\r\n\r\n  private static PERSIST_ROOT_NODE_NET: cc.Node;\r\n  private static PERSIST_ROOT_NODE_MODULE: cc.Node;\r\n  private static rootUI: IRootUI;\r\n  private static singleInstance: GamePersist;\r\n\r\n  @property(cc.Prefab)\r\n  public toastPrefab: cc.Prefab = null;\r\n  @property({type:cc.AudioClip})\r\n  private pBtnAudio_1: cc.AudioClip = null;    // 按钮声音\r\n  @property({type:cc.AudioClip})\r\n  private pBtnAudio_2: cc.AudioClip = null;    // 按钮声音\r\n  @property(cc.Node)\r\n  nodTip: cc.Node = null;\r\n  @property(cc.Node)\r\n  nodWaitting: cc.Node = null;\r\n  @property(cc.Node)\r\n  layerToast: cc.Node = null;\r\n\r\n  private nodeProtoErrDispatcher: cc.Node = null;\r\n  private rootUI: IRootUI = null;\r\n  private waitingPool: cc.NodePool = null;\r\n  private waitingNode: cc.Node = null;\r\n  private serverTime: number = 0;\r\n  private syncServerTimeTick: number = 0;\r\n\r\n  public directionScene = null;\r\n\r\n  public onLoad() {\r\n    // cc.view.enableAntiAlias(false);\r\n    GamePersist.singleInstance = this;\r\n    const self = this;\r\n\r\n    cc.game.addPersistRootNode(this.node);\r\n    Partner.registerZipLoad();\r\n    Partner.registerToastCallback(function (msg: string) {\r\n      self.toast(msg);\r\n    });\r\n\r\n    // 网络的root节点\r\n    GamePersist.PERSIST_ROOT_NODE_NET = new cc.Node(Defines.GAME_PERSIST_NODE_ROOT_NET);\r\n    this.node.addChild(GamePersist.PERSIST_ROOT_NODE_NET);\r\n    this.nodeProtoErrDispatcher = new cc.Node();\r\n    this.node.addChild(this.nodeProtoErrDispatcher);\r\n    // 模块的root节点\r\n    GamePersist.PERSIST_ROOT_NODE_MODULE = new cc.Node(Defines.GAME_PERSIST_NODE_ROOT_MODULE);\r\n    this.node.addChild(GamePersist.PERSIST_ROOT_NODE_MODULE);\r\n\r\n    // 协议各子模块触发器节点添加到NetController\r\n    ProtoDispatcher.fillDispatcher(NetController.INSTANCE.node);\r\n    // 各子模块逻辑控制初始化\r\n    ModuleManagerUtil.InitManager();\r\n    // // 初始化toast复用节点\r\n    // for (let i = 0; i < 5; i++) {\r\n    //   GamePersist.ToastPool.put(cc.instantiate(this.toastPrefab));\r\n    // }\r\n\r\n    SocialManager.INSTANCE.init();\r\n    RuntimeManager.INSTANCE.init();\r\n  }\r\n\r\n  public start() {\r\n    //console.log('GamePersist-start');\r\n    AccManager.INSTANCE.RetryTimes = 0;\r\n\r\n    this.node.x = cc.view.getVisibleSize().width / 2;\r\n    this.node.y = cc.view.getVisibleSize().height / 2;\r\n  }\r\n\r\n  public static get RootNodeNet(): cc.Node {\r\n    return GamePersist.PERSIST_ROOT_NODE_NET;\r\n  }\r\n\r\n  public static get RootNodeModule(): cc.Node {\r\n    return GamePersist.PERSIST_ROOT_NODE_MODULE;\r\n  }\r\n\r\n  public ForceWaiting(msg?: string) {\r\n    this.nodWaitting.active = true;\r\n    this.nodWaitting.getComponent(cc.Animation).play('aniWaitting');\r\n  }\r\n\r\n  public CancelWaiting() {\r\n    this.nodWaitting.getComponent(cc.Animation).stop('aniWaitting');\r\n    this.nodWaitting.active = false;\r\n  }\r\n\r\n  public Toast(msg: string) {\r\n    GamePersist.INSTANCE.toast(msg);\r\n  }\r\n\r\n  // toast tips\r\n  public toast(message: string, colorType?, delayTime?) {\r\n    var toastNode: cc.Node = GamePersist.ToastPool.get();\r\n    if (!toastNode) {\r\n      toastNode = cc.instantiate(this.toastPrefab);\r\n    }\r\n    toastNode.parent = this.layerToast;\r\n    const toast: Toast = toastNode.getComponent(\"Toast\");\r\n    toast.setMessage(message, colorType, delayTime);\r\n    return toast;\r\n  }\r\n\r\n  // 显示维护信息\r\n  public async showMaintain(msg: string) {\r\n    if (!this.rootUI) {\r\n      return;\r\n    }\r\n    this.ForceWaiting();\r\n    try {\r\n      // const panel: PanelConfirm = await PanelConfirm.NewPanel();\r\n      // panel.configOnlyYes();\r\n      // panel.setContent(msg);\r\n      // this.rootUI.showPanel(panel);\r\n    } catch (err) {\r\n      cc.error(`load confirm panel err:${err}`);\r\n    }\r\n    this.CancelWaiting();\r\n  }\r\n\r\n\r\n  // 开始同步时间\r\n  public startSyncServerTime() {\r\n    const self = this;\r\n    const callback = function () {\r\n      AccManager.INSTANCE.requestServerTime();\r\n    };\r\n    // 为了防止添加2次\r\n    this.unschedule(callback);\r\n    this.schedule(callback, 5);\r\n  }\r\n\r\n  // 播放按钮音效\r\n  public btnAudio_1() {\r\n    cc.audioEngine.play(this.pBtnAudio_1, false, 1.0);\r\n  }\r\n  public btnAudio_2() {\r\n    cc.audioEngine.play(this.pBtnAudio_2, false, 1.0);\r\n  }\r\n\r\n  // 触发协议错误事件\r\n  public EmitProtoError(protoMsgSection: number, protoName: string, errCode: number, errMsg: string) {\r\n    const eventName = \"proto_section_\" + protoMsgSection;\r\n    const errProto: any = {};\r\n    errProto.errCode = errCode;\r\n    errProto.errMsg = errMsg;\r\n    errProto.protoName = protoName;\r\n    this.nodeProtoErrDispatcher.emit(eventName, errProto);\r\n  }\r\n\r\n  // 注册关注协议错误事件\r\n  public OnProtoError(protoMsgSection: number, callback: (data) => void, target?: any) {\r\n    const eventName = \"proto_section_\" + protoMsgSection;\r\n    this.nodeProtoErrDispatcher.on(eventName, callback, target);\r\n  }\r\n\r\n  // 取消关注协议错误事件\r\n  public OffProtoError(protoMsgSection: number, callback: Function, target?: any) {\r\n    const eventName = \"proto_section_\" + protoMsgSection;\r\n    this.nodeProtoErrDispatcher.off(eventName, callback, target);\r\n  }\r\n\r\n  public set ServerTime(value: number) {\r\n    this.serverTime = value;\r\n  }\r\n  public get ServerTime(): number {\r\n    return this.serverTime;\r\n  }\r\n\r\n  public set RootUI(value: IRootUI) {\r\n    this.rootUI = value;\r\n  }\r\n\r\n  public get RootUI(): IRootUI {\r\n    return this.rootUI;\r\n  }\r\n\r\n  public get WaitingPool(): cc.NodePool {\r\n    return this.waitingPool;\r\n  }\r\n\r\n  // 是否显示了且未隐藏切换场景动画\r\n  _hasShowTips = false;\r\n  // 开始切换场景\r\n  loadScene(sceneName, cb?) {\r\n    if (!this._hasShowTips) {\r\n      this._hasShowTips = true;\r\n      this.nodTip.getComponent('Tips').show();\r\n    }\r\n\r\n    var time = Date.now();\r\n    cc.director.preloadScene(sceneName, () => {\r\n      var leftTime = Date.now() - time;\r\n      if (false && leftTime < 1000) {\r\n        setTimeout(() => {\r\n          cc.director.loadScene(sceneName, () => {\r\n            cb && cb();\r\n          })\r\n        }, (1000 - leftTime))\r\n      } else {\r\n        setTimeout(() => {\r\n          cc.director.loadScene(sceneName, () => {\r\n            cb && cb();\r\n          })\r\n        }, 50)\r\n      }\r\n    });\r\n  }\r\n  // 切换场景完成回调\r\n  onLoadSceneEnd(cb?) {\r\n    if (!this._hasShowTips) {\r\n      return\r\n    }\r\n    this._hasShowTips = false;\r\n    var action = cc.sequence(\r\n      cc.fadeOut(0.2),\r\n      cc.callFunc(() => {\r\n        cb && cb();\r\n        this.nodTip.getComponent('Tips').hide();\r\n      })\r\n    );\r\n    this.nodTip.runAction(action);\r\n  }\r\n\r\n\r\n  panelPopUp(node, cb?) {\r\n    node.stopAllActions();\r\n    var action = cc.sequence(\r\n      cc.scaleTo(0.1, 1.02, 1.02),\r\n      cc.scaleTo(0.1, 0.98, 0.98),\r\n      cc.scaleTo(0.1, 1, 1),\r\n      cc.callFunc(() => {\r\n        cb && cb();\r\n      })\r\n    );\r\n    node.active = true;\r\n    node.scale = 0.95;\r\n    node.runAction(action)\r\n  }\r\n\r\n  panelFadeOut(node, cb?) {\r\n    node.stopAllActions();\r\n    var action = cc.sequence(\r\n      cc.fadeOut(0.2),\r\n      cc.callFunc(() => {\r\n        cb && cb()\r\n      })\r\n    )\r\n    node.runAction(action)\r\n  }\r\n\r\n  blockInput() {\r\n    GamePersist.singleInstance.getComponent(cc.BlockInputEvents).enabled = true;\r\n    setTimeout(function () {\r\n      GamePersist.singleInstance.node.getComponent(cc.BlockInputEvents).enabled = false;\r\n    }, 1000);\r\n  }\r\n\r\n  \r\n}\r\n"]}