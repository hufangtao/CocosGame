{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui/assets\\scripts\\app\\ui\\UIAddStep.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui","sourcesContent":["import { Message } from \"../common/Message\";\r\nimport LayerGamePve from \"../component/game/pve/LayerGamePve\";\r\nimport { Play } from \"../module/Modules\";\r\nimport GamePersist from \"../common/persist/GamePersist\";\r\nimport { UIFunc } from \"../common/UIFunc\";\r\nimport StateMgr from \"../component/game/pve/StateMgr\";\r\nimport { DYNotify } from \"../../dyGame/DYNotify\";\r\nimport { ShareManager } from \"../common/ShareManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class UIAddStep extends cc.Component {\r\n    onEnable() {\r\n        DYNotify.regObserver(Message.GET_SHARE_CNT, this.onNotify, this);\r\n    }\r\n\r\n    onDisable() {\r\n        DYNotify.removeAllObservers(this);\r\n    }\r\n\r\n    layerGame: LayerGamePve;\r\n    // 显示增加步数界面\r\n    init(layerGame) {\r\n        this.layerGame = layerGame;\r\n        if (Play.DataPve.levelData.time > 0) {\r\n            this.node.getChildByName('addTime').active = true;\r\n            this.node.getChildByName('addStep').active = false;\r\n\r\n        } else {\r\n            this.node.getChildByName('addTime').active = false;\r\n            this.node.getChildByName('addStep').active = true;\r\n\r\n        }\r\n    }\r\n\r\n    showAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            GamePersist.INSTANCE.blockInput();\r\n            window['Partner'].showVideoAd(() => {\r\n                ShareManager.Instance.notifyWatchAdAddStep();\r\n                this.onWatchAd();\r\n            }, () => {\r\n                this.share();\r\n            });\r\n        } else {\r\n            cc.log('不支持广告');\r\n            ShareManager.Instance.notifyWatchAdAddStep();\r\n            this.onWatchAd();\r\n        }\r\n    }\r\n    // 看广告回调\r\n    onWatchAd() {\r\n        UIFunc.closeUI('UIAddStep', () => { })\r\n        if (Play.DataPve.levelData.time > 0) {\r\n            StateMgr.INSTANCE.isStopOperate = false;\r\n            Play.DataPve.hadAddStep = true;\r\n            Play.DataPve.remainTime = 10;\r\n            this.layerGame.panelHeader.updateTime();\r\n        } else {\r\n            StateMgr.INSTANCE.isStopOperate = false;\r\n            Play.DataPve.hadAddStep = true;\r\n            Play.DataPve.remainStep = 5;\r\n            this.layerGame.panelHeader.updateLabelStep();\r\n        }\r\n    }\r\n\r\n    private onNotify(target, tag, param) {\r\n        var self = target;\r\n        if (tag == Message.GET_SHARE_CNT) {\r\n            if (param.reason != 5) {\r\n                return;\r\n            }\r\n            if (param.success == 1) {\r\n                self.onWatchAd();\r\n            }  else if(param.success === 0){\r\n                GamePersist.INSTANCE.toast('免费额外资源已用完，明天再试试');\r\n            }\r\n        }\r\n    }\r\n    \r\n    share() {\r\n        GamePersist.INSTANCE.btnAudio_1();\r\n        ShareManager.Instance.share(5);\r\n    }\r\n\r\n\r\n    public btnListener(event: cc.Event.EventTouch) {\r\n        var target = event.target;\r\n        switch (target.name) {\r\n            case 'btnGiveUp':\r\n                GamePersist.INSTANCE.btnAudio_1();\r\n                this.layerGame.PlayUI.loseGame();\r\n                UIFunc.closeUI('UIAddStep', () => { })\r\n                break;\r\n            case 'btnWatchAd':\r\n                GamePersist.INSTANCE.btnAudio_1();\r\n                this.showAd();\r\n                // this.onWatchAd();\r\n                break;\r\n        }\r\n    }\r\n}\r\n"]}