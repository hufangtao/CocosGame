{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\dyGame/assets\\scripts\\dyGame\\DYHttpMgr.ts"],"names":[],"mappings":";;;;;AAAA,qCAAgC;AAEhC,IAAY,aAKX;AALD,WAAY,aAAa;IACrB,sCAAwB,CAAA;IACxB,yCAAwB,CAAA;IACxB,uCAAwB,CAAA;IACxB,yCAAwB,CAAA;AAC5B,CAAC,EALW,aAAa,GAAb,qBAAa,KAAb,qBAAa,QAKxB;AAAA,CAAC;AAEF,IAAI,YAAY,GAAM,wDAAwD,CAAC;AAE/E;IAAA;IAyIA,CAAC;IAvIU,4BAAe,GAAtB,UAAuB,EAAa;QAChC,IAAI,GAAG,GAAG,YAAY,GAAG,cAAc,CAAC;QACxC,IAAI,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC;QAC1B,CAAC,CAAC,MAAM,GAAG,iBAAO,CAAC,MAAM,EAAE,CAAC;QAC5B,CAAC,CAAC,OAAO,GAAG,iBAAO,CAAC,OAAO,EAAE,CAAC;QAC9B,CAAC,CAAC,WAAW,GAAG,iBAAO,CAAC,WAAW,EAAE,CAAC;QACtC,CAAC,CAAC,OAAO,GAAG,iBAAO,CAAC,OAAO,EAAE,CAAC;QAC9B,CAAC,CAAC,IAAI,GAAG,iBAAO,CAAC,QAAQ,EAAE,CAAC;QAC5B,CAAC,CAAC,IAAI,GAAG,iBAAO,CAAC,QAAQ,EAAE,CAAC;QAE5B,IAAI,CAAC,aAAa,CAAC,UAAS,GAAG,EAAE,IAAI;YACjC,IAAI,EAAE,EAAE;gBACJ,EAAE,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;aACjB;QACL,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;IACtB,CAAC;IAGD,wBAAwB;IACxB,KAAK;IACL,qCAAqC;IACrC,8BAA8B;IAC9B,oCAAoC;IACpC,0CAA0C;IAC1C,oBAAoB;IACpB,MAAM;IACC,0BAAa,GAApB,UAAqB,EAAY,EAAE,MAAW,EAAE,GAAW,EAAE,MAAc;QACvE,IAAI,GAAG,GAAG,EAAE,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC;QACxC,mEAAmE;QAEnE,+DAA+D;QAC/D,yBAAyB;QACzB,8DAA8D;QAC9D,IAAI;QAEJ,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,IAAI,SAAS,GAAG,KAAK,CAAC;QAEtB,GAAG,CAAC,SAAS,GAAG;YACZ,SAAS,GAAG,IAAI,CAAC;YACjB,GAAG,CAAC,KAAK,EAAE,CAAC;YACZ,IAAI,KAAK,EAAE;gBACP,KAAK,CAAC,CAAC,CAAC,EAAE,YAAY,GAAG,GAAG,CAAC,CAAC;gBAC9B,KAAK,GAAG,IAAI,CAAC;aAChB;QACL,CAAC,CAAC;QACF,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC;QAEpB,GAAG,CAAC,kBAAkB,GAAG;YACrB,IAAI,CAAC,GAAG,IAAI,SAAS,EAAE;gBACnB,OAAO;aACV;YACD,0FAA0F;YAC1F,IAAI,GAAG,CAAC,UAAU,IAAI,CAAC,EAAE,EAAE,gDAAgD;gBACvE,IAAI,QAAQ,GAAG,GAAG,CAAC,YAAY,CAAC;gBAChC,sBAAsB;gBACtB,IAAI,KAAK,EAAE;oBACP,IAAI,IAAI,GAAG,EAAE,CAAC;oBACd,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,EAAE;wBACnB,IAAI;4BACA,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;4BACxB,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;yBAC/B;wBAAC,OAAO,CAAC,EAAE;4BACR,IAAI,GAAG,EAAE,CAAC;yBACb;wBAED,+CAA+C;wBAC/C,sFAAsF;wBACtF,iCAAiC;wBACjC,UAAU;wBACV,WAAW;wBACP,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;wBACtB,IAAI;qBACP;yBAAM;wBACH,KAAK,CAAC,GAAG,CAAC,MAAM,IAAI,CAAC,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;qBAC3D;oBAED,KAAK,GAAG,IAAI,CAAC;iBAChB;aACJ;YACD,gCAAgC;YAChC,kGAAkG;YAClG,IAAI;QACR,CAAC,CAAC;QAEF,GAAG,CAAC,OAAO,GAAG;YACV,IAAI,KAAK,EAAE;gBACP,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,GAAG,GAAG,CAAC,CAAC;gBAC5B,KAAK,GAAG,IAAI,CAAC;aAChB;QACL,CAAC,CAAC;QAEF,MAAM,GAAG,MAAM,IAAI,EAAE,CAAC;QACtB,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,IAAI,iBAAO,CAAC,MAAM,EAAE,CAAC;QAClD,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,iBAAO,CAAC,OAAO,EAAE,CAAC;QACrD,MAAM,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,IAAI,iBAAO,CAAC,QAAQ,EAAE,CAAC;QACxD,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,IAAI,iBAAO,CAAC,QAAQ,EAAE,CAAC;QAChD,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,iBAAO,CAAC,OAAO,EAAE,CAAC;QAErD,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,KAAK,IAAI,GAAG,IAAI,MAAM,EAAE;YACpB,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;gBACrB,QAAQ,GAAG,QAAQ,GAAG,GAAG,CAAC;aAC7B;YACD,QAAQ,GAAG,QAAQ,GAAG,iBAAO,CAAC,MAAM,CAAC,SAAS,EAAE,GAAG,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;SACrE;QAED,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,IAAI,OAAO,IAAI,iBAAO,CAAC,QAAQ,EAAE,EAAE;gBAC/B,GAAG,CAAC,gBAAgB,CAAC,iBAAiB,EAAE,cAAc,CAAC,CAAC;aAC3D;SAEJ;QACD,QAAQ;QACR,iFAAiF;QACjF,kGAAkG;QAClG,IAAI;QAEJ,MAAM,GAAG,MAAM,IAAI,KAAK,CAAC;QACzB,IAAI,MAAM,IAAI,KAAK,EAAE;YACjB,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;gBACrB,GAAG,GAAG,SAAS,CAAC,iBAAO,CAAC,MAAM,CAAC,iBAAiB,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE,iBAAO,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;aAClG;YACD,kCAAkC;YAElC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;YAC3B,GAAG,CAAC,IAAI,EAAE,CAAC;SACd;aAAM;YACH,mCAAmC;YAEnC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;YAC5B,QAAQ,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC;YAC/B,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SACtB;IACL,CAAC;IACL,mBAAC;AAAD,CAzIA,AAyIC,IAAA;;AAAA,CAAC","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\dyGame","sourcesContent":["import DYUtils from './DYUtils';\r\n\r\nexport enum DYUpdateEvent{\r\n    EVENT_NO_UPDATE    = \"0\",\r\n    EVENT_QUIET_UPDATE = \"1\", \r\n    EVENT_TIP_UPDATE   = \"2\",\r\n    EVENT_FORCE_UPDATE = \"3\",\r\n};\r\n\r\nvar S_HOTFIX_URL    = \"http://entrance1.xxxy.dayukeji.com:10002/Hotfix/hotfix\"; \r\n\r\nexport default class DYHttpHelper {\r\n\r\n    static checkUpdateInfo(cb : Function) {\r\n        var url = S_HOTFIX_URL + \"/checkupdate\";\r\n        var t = cc.js.createMap();\r\n        t.gameId = DYUtils.gameId();\r\n        t.gameVer = DYUtils.gameVer();\r\n        t.gameOrigVer = DYUtils.gameOrigVer();\r\n        t.channel = DYUtils.channel();\r\n        t.plat = DYUtils.platform();\r\n        t.mode = DYUtils.gameMode();\r\n\r\n        this.requestCommon(function(err, resp) {\r\n            if (cb) {\r\n                cb(err, resp);\r\n            }\r\n        }, t, url, \"GET\");\r\n    }\r\n\r\n   \r\n    // /** Common requestor.\r\n    //  *\r\n    //  * @param {function} cb \"callback\"\r\n    //  * @param {table} params \"\"\r\n    //  * @param {String} url \"base url\"\r\n    //  * @param {String} method \"GET or POST\"\r\n    //  * @return {null}\r\n    //  */\r\n    static requestCommon(cb: Function, params: any, url: string, method: string) {\r\n        var xhr = cc.loader.getXMLHttpRequest();\r\n        // this.streamXHREventsToLabel(xhr, this.xhr, this.xhrResp, \"GET\");\r\n\r\n        // xhr.open(\"GET\", \"https://httpbin.org/get?show_env=1\", true);\r\n        // if (cc.sys.isNative) {\r\n        //     xhr.setRequestHeader(\"Accept-Encoding\",\"gzip,deflate\");\r\n        // }\r\n\r\n        let xhrcb = cb;\r\n        let isAborted = false;\r\n\r\n        xhr.ontimeout = function() {\r\n            isAborted = true;\r\n            xhr.abort();\r\n            if (xhrcb) {\r\n                xhrcb(-1, \"ontimeout;\" + url);\r\n                xhrcb = null;\r\n            }\r\n        };\r\n        xhr.timeout = 15000;\r\n\r\n        xhr.onreadystatechange = function() {\r\n            if (!xhr || isAborted) {\r\n                return;\r\n            }\r\n            // // DDLOG(\"onreadystatechange, readyState={0}, statue={1}\", xhr.readyState, xhr.status);\r\n            if (xhr.readyState == 4) { // && (xhr.status >= 200 && xhr.status < 400)) {\r\n                var response = xhr.responseText;\r\n                // // DDLOG(response);\r\n                if (xhrcb) {\r\n                    var resp = {};\r\n                    if (xhr.status == 200) {\r\n                        try {\r\n                            DYUtils.DDLOG(response);\r\n                            resp = JSON.parse(response);\r\n                        } catch (e) {\r\n                            resp = {};\r\n                        }\r\n\r\n                        // if (resp.errorCode == ERROR_TOKEN_EXPIRED) {\r\n                        //     HYCommon.alert(dy.i18n.t(\"S_8\"), resp.errorMsg, dy.i18n.t(\"S_34\"), function() {\r\n                        //         DYUtils.tryQuit(true);\r\n                        //     });\r\n                        // } else {\r\n                            xhrcb(null, resp);\r\n                        // }\r\n                    } else {\r\n                        xhrcb(xhr.status || -1, \"on_\" + xhr.status + \";\" + url);\r\n                    }\r\n\r\n                    xhrcb = null;\r\n                }\r\n            }\r\n            // else if(xhr.readyState == 1){\r\n            //     xhr.setRequestHeader(\"Access-Control-Allow-Origin\", \"http://entrance1.xxxy.dayukeji.com\"); \r\n            // }\r\n        };\r\n\r\n        xhr.onerror = function() {\r\n            if (xhrcb) {\r\n                xhrcb(-2, \"onerror;\" + url);\r\n                xhrcb = null;\r\n            }\r\n        };\r\n\r\n        params = params || {};\r\n        params.gameId = params.gameId || DYUtils.gameId();\r\n        params.gameVer = params.gameVer || DYUtils.gameVer();\r\n        params.gameMode = params.gameMode || DYUtils.gameMode();\r\n        params.plat = params.plat || DYUtils.platform();\r\n        params.channel = params.channel || DYUtils.channel();\r\n\r\n        var strParam = \"\";\r\n        for (var key in params) {\r\n            if (strParam.length > 0) {\r\n                strParam = strParam + \"&\";\r\n            }\r\n            strParam = strParam + DYUtils.format(\"{0}={1}\", key, params[key]);\r\n        }\r\n\r\n        if (cc.sys.isNative) {\r\n            if (\"win32\" != DYUtils.platform()) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n\r\n        }\r\n        // else{\r\n        //     // xhr.setRequestHeader(\"Access-Control-Allow-Origin\", \"*.dayukeji.com\"); \r\n        //     // xhr.setRequestHeader(\"Access-Control-Allow-Origin: http://entrance1.xxxy.dayukeji.com\");\r\n        // }\r\n\r\n        method = method || \"GET\";\r\n        if (method == \"GET\") {\r\n            if (strParam.length > 0) {\r\n                url = encodeURI(DYUtils.format(\"{0}?{1}&{2}={3}\", url, strParam, \"ts\", DYUtils.currentTick()));\r\n            }\r\n            // DDLOG(\"GET urlApi : {0}\", url);\r\n\r\n            xhr.open(\"GET\", url, true);\r\n            xhr.send();\r\n        } else {\r\n            // DDLOG(\"POST urlApi : {0}\", url);\r\n\r\n            xhr.open(\"POST\", url, true);\r\n            strParam = encodeURI(strParam);\r\n            xhr.send(strParam);\r\n        }\r\n    }\r\n};"]}