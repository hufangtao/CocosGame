{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\component\\page\\login/assets\\scripts\\app\\component\\page\\login\\LoginUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\component\\page\\login","sourcesContent":["import { AccLoginS2C } from \"../../../common/net/proto/mods/ProtoSectionAcc\";\r\nimport * as ConfigVO from \"../../../common/config/vo/ConfigVO\";\r\nimport AccManager from \"./AccManager\";\r\nimport BaseUI from \"../../BaseUI\";\r\nimport GamePersist from \"../../../common/persist/GamePersist\";\r\nimport ResLoader from \"../../../common/loader/Loader\";\r\nimport DotAnimation from \"../preload/DotAnimation\";\r\nimport { ProtoErrorCode } from \"../../../common/net/proto/ProtoReflect\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class LoginUI extends BaseUI {\r\n\r\n  @property(cc.Node)\r\n  public nodeAccInput: cc.Node = null;\r\n\r\n  @property(cc.Node)\r\n  public nodeAccCreateRole: cc.Node = null;\r\n\r\n  @property(cc.Button)\r\n  public btnLogin: cc.Button = null;\r\n\r\n  @property(cc.Button)\r\n  public btnServer: cc.Button = null;\r\n\r\n  @property(cc.Button)\r\n  public btnReAuthorize: cc.Button = null;\r\n\r\n  @property(cc.EditBox)\r\n  public userAccount: cc.EditBox = null;\r\n\r\n  public loginData;\r\n\r\n  private loadingAnimation: DotAnimation = null;\r\n\r\n\r\n  /*\r\n  ================\r\n  生命周期回调\r\n  ================\r\n  */\r\n\r\n  public onLoad() {\r\n    super.onLoad();\r\n    this.btnLogin.node.on(cc.Node.EventType.TOUCH_END, this.handleLoginWithInput, this);\r\n    this.btnServer.node.on(cc.Node.EventType.TOUCH_END, this.handleSelectServer, this);\r\n    this.btnServer.node.active = false;\r\n    this.btnReAuthorize.node.on(cc.Node.EventType.TOUCH_END, this.onReAuthorize, this);\r\n    // if (Partner.PARTNER_NAME === \"Dev\") {\r\n    //   this.btnTestWaiting.node.active = true;\r\n    // } else {\r\n    //   this.btnTestWaiting.node.active = false;\r\n    // }\r\n\r\n    //固定服务器ID\r\n    AccManager.INSTANCE.setServerData(window['Partner'].getServerId());\r\n\r\n    const dotAnimation = DotAnimation.NewDotAnimation();\r\n    dotAnimation.node.parent = this.node;\r\n    dotAnimation.node.y = (-458);\r\n    this.loadingAnimation = dotAnimation;\r\n  }\r\n\r\n  public hideLoading() {\r\n    if (this.loadingAnimation) {\r\n      this.loadingAnimation.node.active = false;\r\n    }\r\n  }\r\n\r\n  public showLoading() {\r\n    if (this.loadingAnimation) {\r\n      this.loadingAnimation.node.active = true;\r\n    }\r\n  }\r\n\r\n  public start() {\r\n    super.start();\r\n    AccManager.INSTANCE.LoginUI = this;\r\n\r\n    // 调用第三方合作商进行账号授权操作\r\n    const self = this;\r\n    window['Partner'].doAccAuthorize(function (data) {\r\n      AccManager.INSTANCE.didGetAuthorize(data);\r\n    }, function (howTo: number) {\r\n      self.showAccInput(howTo);\r\n    }, AccManager.INSTANCE.existSavedGameAccount());\r\n  }\r\n\r\n  public onDestroy() {\r\n    AccManager.INSTANCE.LoginUI = null;\r\n  }\r\n\r\n\r\n  public uiName(): string {\r\n    return \"LoginUI\";\r\n  }\r\n\r\n  public onReAuthorize() {\r\n    // GamePersist.INSTANCE.btnAudio_1();\r\n    const that = this;\r\n    this.showLoading();\r\n\r\n    // 调用第三方合作商进行账号授权操作\r\n    window['Partner'].doAccAuthorize(function (data) {\r\n      AccManager.INSTANCE.didGetAuthorize(data);\r\n    }, function (howTo: number) {\r\n      that.showAccInput(howTo);\r\n    }, AccManager.INSTANCE.existSavedGameAccount());\r\n  }\r\n  // ================================================\r\n\r\n  /*\r\n  howTo\r\n      0: 什么都不做\r\n      1: 显示输入账号界面 这个仅在开发环境才会有\r\n      2: 显示重新登录按钮 用于新触发第三方登录逻辑\r\n  */\r\n  public showAccInput(howTo: number) {\r\n    if (howTo === 0) {\r\n      this.nodeAccInput.active = false;\r\n      this.btnReAuthorize.node.active = false;\r\n      return;\r\n    }\r\n\r\n    this.hideLoading();\r\n    if (howTo === 1) {\r\n      this.nodeAccInput.active = true;\r\n    } else {\r\n      this.btnReAuthorize.node.active = true;\r\n    }\r\n  }\r\n\r\n  // 使用玩家输入的账号进行登录\r\n  public handleLoginWithInput(event: cc.Event.EventTouch) {\r\n    GamePersist.INSTANCE.btnAudio_1();\r\n    const account: string = this.userAccount.string;\r\n    if (!account || account.length < 1) {\r\n      GamePersist.INSTANCE.toast(\"请输入账号\");\r\n      return;\r\n    }\r\n    const data: any = {};\r\n    data.openid = account;\r\n    data.openkey = account;\r\n    data.platform = \"Dev\";\r\n    data.params = \"\";\r\n    window['Partner'].didAccAuthorize(data);\r\n  }\r\n\r\n  public handleSelectServer(event: cc.Event.EventTouch) {\r\n    const self = this;\r\n    GamePersist.INSTANCE.btnAudio_1();\r\n    GamePersist.INSTANCE.ForceWaiting();\r\n    ResLoader.loadSingle(\"prefab/login/SelectServer\", function (err, ss: cc.Prefab) {\r\n      const ssNode: cc.Node = cc.instantiate(ss);\r\n      ssNode.parent = self.node;\r\n      ssNode.setPosition(0, 0);\r\n      GamePersist.INSTANCE.CancelWaiting();\r\n    });\r\n  }\r\n\r\n  // 显示创建角色的界面\r\n  public showAccCreateRole() {\r\n    const self = this;\r\n    this.showAccInput(0);\r\n    GamePersist.INSTANCE.ForceWaiting();\r\n    ResLoader.loadSingle(\"prefab/login/AccCreateRole\", function (err, prefab: cc.Prefab) {\r\n      const nodeCreateRole: cc.Node = cc.instantiate(prefab);\r\n      nodeCreateRole.parent = self.nodeAccCreateRole;\r\n      nodeCreateRole.setPosition(0, 0);\r\n      GamePersist.INSTANCE.CancelWaiting();\r\n    });\r\n  }\r\n}\r\n\r\n"]}