{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\component\\game\\pve\\prefab/assets\\scripts\\app\\component\\game\\pve\\prefab\\BaseTile.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\component\\game\\pve\\prefab","sourcesContent":["import { TILE_TYPE, TILE_ZINDEX, GAME_MODEL, Action_type } from \"../../PlayDefine\";\r\nimport { Play } from \"../../../../module/Modules\";\r\nimport LayerGame from \"../../pvp/LayerGame\";\r\nimport LayerGamePve from \"../LayerGamePve\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BaseTile extends cc.Component {\r\n    @property(cc.Node)\r\n    nodContent: cc.Node = null;\r\n\r\n    x: number;\r\n    y: number;\r\n\r\n    private _isDestroying: boolean = false;\r\n    private _isMoving: boolean = false;\r\n\r\n    _tileType: TILE_TYPE = null;\r\n    _type = null;\r\n    _subType = null;\r\n\r\n    force: cc.Vec2 = null;\r\n\r\n    distance1 = 50;\r\n    distance2 = 15;\r\n\r\n    distance3 = 30;\r\n    distance4 = 10;\r\n\r\n    _game;\r\n\r\n    _canTouch = false;\r\n\r\n    public get game() {\r\n        return this._game;\r\n    }\r\n    public set game(value) {\r\n        this._game = value;\r\n    }\r\n\r\n    public get canTouch() {\r\n        return this._canTouch;\r\n    }\r\n    public set canTouch(value) {\r\n        this._canTouch = value;\r\n    }\r\n\r\n    public get tileType() {\r\n        return this._tileType;\r\n    }\r\n    public set tileType(value) {\r\n        this.setSpfByTileType(value);\r\n        this._tileType = value;\r\n    }\r\n    public get type() {\r\n        return this._type;\r\n    }\r\n    public set type(value) {\r\n        this._type = value;\r\n        this.setSpfByType(value);\r\n    }\r\n    public get subType() {\r\n        return this._subType;\r\n    }\r\n    public set subType(value) {\r\n        this.setSpfBySubType(value);\r\n        this._subType = value;\r\n    }\r\n\r\n    public set isDestroying(value) {\r\n        this._isDestroying = value;\r\n    }\r\n    public get isDestroying() {\r\n        return this._isDestroying;\r\n    }\r\n    onLoad() {\r\n\r\n    }\r\n    onDestroy() {\r\n    }\r\n    onDisable() {\r\n        this.actionCallBack = null;\r\n        cc.director.getScheduler().unscheduleAllForTarget(this);\r\n        this.node.targetOff(this.node);\r\n    }\r\n\r\n    onEnable() {\r\n\r\n    }\r\n\r\n    setSpfByTileType(type) {\r\n\r\n    }\r\n    setSpfByType(type) {\r\n\r\n    }\r\n    setSpfBySubType(type) {\r\n\r\n    }\r\n    // 正确的位置\r\n    public getArrPosition() {\r\n        return cc.v2(this.node.width * (this.x - 4) + this.node.width / 2,\r\n            this.node.height * this.y + this.node.height / 2);\r\n    }\r\n\r\n    public newTile(x: number, y: number, isMoveTo = true) {\r\n\r\n    }\r\n\r\n    // 收获目标\r\n    recoveryObjective(isTouch?) {\r\n        if (Play.GameModel === GAME_MODEL.PVE) {\r\n            Play.DataPve.getObjective(this.tileType, this.type, this.subType, isTouch);\r\n            this._game.gameOver();\r\n        }\r\n    }\r\n\r\n\r\n\r\n    init() {\r\n        this.actionCallBack = null;\r\n        this._canTouch = true;\r\n    }\r\n\r\n    actionCallBack;\r\n    // 圆形波浪动作，炸弹\r\n    billowAct(x, y, cb) {\r\n        var self = this;\r\n        this.force = this.getForce(x, y);\r\n        if (!this.force) {\r\n            return;\r\n        }\r\n        self._canTouch = false;\r\n        this.node.zIndex = TILE_ZINDEX.ACTION_LOW;\r\n\r\n        let instance1 = cc.v2(this.x - x, this.y - y).mag();\r\n        if (instance1 < 2) {\r\n            this.isDestroying = true;\r\n            var action = cc.sequence(\r\n                cc.moveBy(0.1, self.force.x * self.distance1 * 2, self.force.y * self.distance1 * 2).easing(cc.easeOut(2)),\r\n                cc.moveTo(0.2, 0, 0),\r\n                cc.spawn(cc.moveBy(0.2, self.force.x * self.distance2 * 2, self.force.y * self.distance2 * 2),\r\n                    cc.callFunc(() => {\r\n                        // self.actionCallBack && self.actionCallBack();\r\n                        // self.actionCallBack = null;\r\n                    })),\r\n                // cc.moveBy(0.2, this.force.x * this.distance2, -speedX * this.distance2),\r\n                cc.moveTo(0.2, 0, 0),\r\n                cc.delayTime(1),\r\n                cc.callFunc((() => {\r\n                    self.node.zIndex = TILE_ZINDEX.NORMAL;\r\n                    self.node.scale = 1;\r\n                    self._canTouch = true;\r\n                }))\r\n            )\r\n\r\n            self.nodContent.stopActionByTag(Action_type.Shake);\r\n            self.nodContent.runAction(action);\r\n            action.setTag(Action_type.Shake);\r\n\r\n            if (!self.actionCallBack) {\r\n                self.actionCallBack = cb;\r\n                self.scheduleOnce(() => {\r\n                    self.actionCallBack && self.actionCallBack();\r\n                }, 0.3)\r\n            }\r\n        } else {\r\n            var action = cc.sequence(\r\n                cc.moveBy(0.1, this.force.x * this.distance1, this.force.y * this.distance1).easing(cc.easeOut(2)),\r\n                cc.moveTo(0.2, 0, 0),\r\n                cc.spawn(cc.moveBy(0.2, self.force.x * self.distance2 * 2, self.force.y * self.distance2 * 2),\r\n                    cc.callFunc(() => {\r\n                        // self.actionCallBack && self.actionCallBack();\r\n                        // self.actionCallBack = null;\r\n                    })),\r\n                cc.moveTo(0.2, 0, 0),\r\n                cc.callFunc((() => {\r\n                    self.node.zIndex = TILE_ZINDEX.NORMAL;\r\n                    self._canTouch = true;\r\n                }))\r\n            )\r\n            self.nodContent.stopActionByTag(Action_type.Shake);\r\n            self.nodContent.runAction(action);\r\n            action.setTag(Action_type.Shake);\r\n        }\r\n    }\r\n\r\n    getForce(x, y) {\r\n        var force = cc.v2(this.x, this.y).sub(cc.v2(x, y));\r\n        var arrPosition = this.getArrPosition();\r\n        var curPosition = this.node.position;\r\n        var length = arrPosition.sub(curPosition).mag();\r\n\r\n        var normalize = force.normalize();\r\n        // if (length >= this.distance1 * normalize.mag()) {\r\n        //     return null\r\n        // }\r\n        return normalize;\r\n    }\r\n\r\n    // 两侧抖动动作，辣椒\r\n    bothSideAct(x, cb) {\r\n        this.force = this.getForce(x, this.y);\r\n        if (!this.force) {\r\n            return;\r\n        }\r\n        this._canTouch = false;\r\n        this.node.zIndex = TILE_ZINDEX.ACTION_LOW;\r\n\r\n        var action = cc.sequence(\r\n            cc.moveBy(0.1, this.force.x * this.distance3, 0).easing(cc.easeOut(2)),\r\n            cc.moveTo(0.2, 0, 0),\r\n            cc.moveBy(0.2, this.force.x * this.distance4, 0),\r\n            cc.moveTo(0.2, 0, 0),\r\n            cc.callFunc((() => {\r\n                this.node.zIndex = TILE_ZINDEX.NORMAL;\r\n                this._canTouch = true;\r\n            }))\r\n        )\r\n        this.nodContent.stopActionByTag(Action_type.Shake);\r\n        this.nodContent.runAction(action);\r\n        action.setTag(Action_type.Shake);\r\n    }\r\n}"]}