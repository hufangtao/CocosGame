{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui/assets\\scripts\\app\\ui\\UIGetCoin.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui","sourcesContent":["import { UIFunc } from \"../common/UIFunc\";\r\nimport GamePersist from \"../common/persist/GamePersist\";\r\nimport { PlayerWatchAdC2S, PlayerShareGameC2S } from \"../common/net/proto/mods/ProtoSectionPlayer\";\r\nimport NetUtil from \"../common/net/NetUtil\";\r\nimport SocialManager from \"../common/social/SocialManager\";\r\nimport { Message } from \"../common/Message\";\r\nimport { DYNotify } from \"../../dyGame/DYNotify\";\r\nimport { Home } from \"../module/Modules\";\r\nimport { ShareManager } from \"../common/ShareManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class UIGetCoin extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    labLeftCount: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    labLackCoin: cc.Label = null;\r\n    @property(cc.Label)\r\n    labGetCoin: cc.Label = null;\r\n\r\n    onEnable() {\r\n        DYNotify.regObserver(Message.GET_SHARE_CNT, this.onNotify, this);\r\n        DYNotify.regObserver(Message.EVENT_MODULE_PLAYER_FORTUNE, this.onNotify, this);\r\n        this.labLeftCount.string = '(' + Home.DataPlayer.CoinShareCnt + '/5)';\r\n        this.labLackCoin.node.active = false;\r\n        this.labGetCoin.node.active = false;\r\n        this.canLoadUIGetProp = true;\r\n    }\r\n\r\n    onDisable() {\r\n        DYNotify.removeAllObservers(this);\r\n    }\r\n\r\n    setType(type) {\r\n        if (type === 1) {\r\n            this.labLackCoin.node.active = true;\r\n        } else if (type === 2) {\r\n            this.labGetCoin.node.active = true;\r\n        }\r\n    }\r\n\r\n    private onNotify(target, tag, param) {\r\n        var self = target;\r\n        if (tag == Message.GET_SHARE_CNT) {\r\n            if (param.reason != 4) {\r\n                return;\r\n            }\r\n            if (param.success == 1) {\r\n                self.onGetCoin();\r\n            } else if (param.success === 0) {\r\n                GamePersist.INSTANCE.toast('免费获得金币次数已用完，明天再试试');\r\n                this.closePanel();\r\n            }\r\n        } else if (tag == Message.EVENT_MODULE_PLAYER_FORTUNE) {\r\n            self.onGetCoin();\r\n        }\r\n    }\r\n    canLoadUIGetProp\r\n    onGetCoin() {\r\n        if(!this.canLoadUIGetProp){\r\n            return;\r\n        }\r\n        this.canLoadUIGetProp = false;\r\n        UIFunc.openUI('UIGetProp', (node) => {\r\n            this.node.active = false;\r\n            node.getComponent('UIGetProp').achieveCoin(100, () => {\r\n                UIFunc.closeUI('UIGetProp', () => { })\r\n            });\r\n        });\r\n    }\r\n\r\n    share() {\r\n        GamePersist.INSTANCE.btnAudio_1();\r\n        ShareManager.Instance.share(4);\r\n    }\r\n\r\n    // 关闭本窗口\r\n    closePanel() {\r\n        UIFunc.closeUI('UIGetCoin', () => { });\r\n    }\r\n\r\n    // 观看视频\r\n    showAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            GamePersist.INSTANCE.blockInput();\r\n            window['Partner'].showVideoAd(() => {\r\n                ShareManager.Instance.notifyWatchAdGetCoin();\r\n                this.onGetCoin();\r\n            }, () => {\r\n                this.share();\r\n            });\r\n        } else {\r\n            cc.log('不支持广告');\r\n            ShareManager.Instance.notifyWatchAdGetCoin();\r\n            this.onGetCoin();\r\n        }\r\n    }\r\n\r\n    public btnListener(event: cc.Event.EventTouch) {\r\n        var target = event.target;\r\n        switch (target.name) {\r\n            case 'btnYes':\r\n                this.showAd();\r\n                target.scale = 1;\r\n                break;\r\n            case 'btnNo':\r\n                this.closePanel();\r\n                target.scale = 1;\r\n                break;\r\n\r\n        }\r\n    }\r\n}\r\n"]}