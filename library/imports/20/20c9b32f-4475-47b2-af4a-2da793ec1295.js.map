{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui/assets\\scripts\\app\\ui\\UITurntable.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui","sourcesContent":["import { ShareManager } from \"../common/ShareManager\";\r\nimport { UIFunc } from \"../common/UIFunc\";\r\nimport { GoodsTurntableRunC2S, GoodsTurntableRunS2C } from \"../common/net/proto/mods/ProtoSectionGoods\";\r\nimport NetUtil from \"../common/net/NetUtil\";\r\nimport { DYNotify } from \"../../dyGame/DYNotify\";\r\nimport { Message } from \"../common/Message\";\r\nimport GamePersist from \"../common/persist/GamePersist\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class UITurntable extends cc.Component {\r\n    @property(cc.Node)\r\n    nodTurntable: cc.Node = null;\r\n    @property(cc.Button)\r\n    btnStart: cc.Button = null;\r\n    @property(cc.Node)\r\n    nodConfirm: cc.Node = null;\r\n\r\n\r\n    angle = [-22.5, 22.5, 67.5, 112.5, 157.5, 202.5, 247.5, 292.5, 337.5]\r\n\r\n    targetNum;\r\n    startTurn: boolean = false;\r\n    stopTurn: boolean = false;\r\n    speed = 10;// 转盘速度\r\n    accSpeed;// 结束时候的减速度\r\n    goodsList;// 转盘获得的物品\r\n    endAngle;// 停下之前需要转的角度\r\n    stopTime = 60;// 停止时间\r\n    turnTime = 3// 转动的时间\r\n    onEnable() {\r\n        DYNotify.regObserver(Message.TURNTABLE_LIST, this.onNotify, this);\r\n        this.startTurn = false;\r\n        this.stopTurn = false;\r\n        this.speed = 10;\r\n        this.nodTurntable.rotation = 0;\r\n        this.btnStart.interactable = true;\r\n        this.canLoadUIGetProp = true;\r\n    }\r\n\r\n    onDisable() {\r\n        DYNotify.removeAllObservers(this);\r\n    }\r\n\r\n    // 启动转盘\r\n    startTurntable(param) {\r\n        this.targetNum = param.id;\r\n        this.btnStart.interactable = false;\r\n        this.startTurn = true;\r\n        this.goodsList = param.goodsList;\r\n\r\n        this.startTurn = true;\r\n        this.scheduleOnce(() => {\r\n            this.stopTurn = true;\r\n        }, this.turnTime)\r\n        return;\r\n\r\n\r\n        this.nodTurntable.runAction(cc.repeatForever(cc.rotateBy(1, 720)));\r\n        this.scheduleOnce(() => {\r\n            this.nodTurntable.stopAllActions();\r\n            let endAngle = randomNum(this.angle[this.targetNum - 1], this.angle[this.targetNum]);\r\n\r\n            let rotation = (endAngle - this.nodTurntable.rotation % 360 + 720) % 360;\r\n            let time = rotation / 720;\r\n            this.nodTurntable.runAction(cc.sequence(\r\n                cc.rotateBy(time, rotation),\r\n                cc.delayTime(1),\r\n                cc.callFunc(() => {\r\n                    this.showGoods(param.goodsList);\r\n                })\r\n            ));\r\n        }, 3);\r\n    }\r\n    canLoadUIGetProp;\r\n    // 展示转盘结果\r\n    showGoods(goodsList) {\r\n        if (!this.canLoadUIGetProp) {\r\n            return;\r\n        }\r\n        this.canLoadUIGetProp = false;\r\n        UIFunc.openUI('UIGetProp', (node) => {\r\n            node.getComponent('UIGetProp').moreProp(goodsList, () => {\r\n                this.canLoadUIGetProp = true;\r\n                UIFunc.closeUI('UIGetProp', () => { })\r\n            });\r\n        })\r\n    }\r\n\r\n    // 提示消耗金币\r\n    userTuentable() {\r\n        if (true) {\r\n            this.notifyTurnTable();\r\n        } else {\r\n            // 确认\r\n            this.nodConfirm.active = true;\r\n        }\r\n    }\r\n\r\n    // 发送启动转盘消息\r\n    notifyTurnTable() {\r\n        let turntableRun = new GoodsTurntableRunC2S();\r\n        NetUtil.SendMsg(turntableRun);\r\n    }\r\n    public btnListener(event: cc.Event.EventTouch) {\r\n        var target = event.target;\r\n        target.scale = 1;\r\n        switch (target.name) {\r\n            case 'btnBack':\r\n                UIFunc.closeUI('UITurntable', () => { });\r\n                break;\r\n            case 'btnStart':\r\n                this.userTuentable();\r\n                break;\r\n        }\r\n    }\r\n    private onNotify(target, tag, param) {\r\n        var self = target;\r\n        if (tag == Message.TURNTABLE_LIST) {\r\n            cc.log(param);\r\n            if (param.goodsList.length == 0) {\r\n                GamePersist.INSTANCE.toast('今日转盘次数已达上限');\r\n            } else {\r\n                self.startTurntable(param);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    update(dt) {\r\n        if (!this.startTurn) {\r\n            return;\r\n        }\r\n        this.nodTurntable.rotation += this.speed;\r\n\r\n        if (this.stopTurn) {\r\n            if (!this.endAngle) {\r\n                let endRotation = randomNum(this.angle[this.targetNum - 1], this.angle[this.targetNum]);\r\n                this.endAngle = (endRotation - this.nodTurntable.rotation % 360 + 720) % 360;\r\n                if (this.endAngle < 180) {\r\n                    this.endAngle += 360;\r\n                }\r\n                this.accSpeed = (- this.speed * this.speed) / 2 / this.endAngle;\r\n            }\r\n\r\n\r\n            this.speed += this.accSpeed;\r\n            if (this.speed <= 0) {\r\n                this.startTurn = false;\r\n                this.stopTurn = false;\r\n                this.speed = 10;\r\n                this.endAngle = null;\r\n                this.showGoods(this.goodsList);\r\n                this.btnStart.interactable = true;\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n\r\nfunction randomNum(startNum, endNum) {\r\n    return Math.random() * (endNum - startNum) + startNum;\r\n}\r\n"]}