{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\common\\loader/assets\\scripts\\app\\common\\loader\\LoadBatch.ts"],"names":[],"mappings":";;;;;AAAA,2CAAsG;AAGtG;IAWE;QACE,IAAI,CAAC,EAAE,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC;QAC7B,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QAClB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACtB,CAAC;IAEM,wBAAI,GAAX,UAAY,QAA8B;QACxC,IAAI,CAAC,oBAAoB,GAAG,QAAQ,CAAC;IACvC,CAAC;IAEM,uBAAG,GAAV,UAAW,QAAkB;QAC3B,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAEM,0BAAM,GAAb,UAAc,QAAkB,EAAE,KAAY,EAAE,QAAa;QAC3D,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBACxB,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;aAC1B;YACD,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,GAAG,QAAQ,CAAC;SAChD;aAAM;YACL,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBACf,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;aACpB;SACF;QAED,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE;YACtB,IAAI,IAAI,CAAC,oBAAoB,EAAE;gBAC7B,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC,EAAE;oBACvB,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;wBACf,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,cAAc,CAAC,6BAAgB,CAAC,CAAC,CAAC;qBAC9E;yBAAM;wBACL,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;qBAC7C;iBACF;qBAAM;oBACL,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;iBAC5D;aACF;SACF;IACH,CAAC;IApDc,gBAAM,GAAW,CAAC,CAAC;IAqDpC,gBAAC;CAtDD,AAsDC,IAAA;kBAtDoB,SAAS","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\common\\loader","sourcesContent":["import { ILoadBatch, LoadCompleteCallback, ILoadedResourceMap, SINGLE_BATCH_KEY } from \"./LoadDefine\";\r\nimport LoadItem from \"./LoadItem\";\r\n\r\nexport default class LoadBatch implements ILoadBatch {\r\n  private static uniqId: number = 0;\r\n\r\n  public id: number;\r\n\r\n  private error: Error;\r\n  private curCount: number;\r\n  private totalCount: number;\r\n  private allCompletedCallback: LoadCompleteCallback;\r\n  private loadedResource: ILoadedResourceMap<any>;\r\n\r\n  constructor() {\r\n    this.id = LoadBatch.uniqId++;\r\n    this.curCount = 0;\r\n    this.totalCount = 0;\r\n  }\r\n\r\n  public then(callback: LoadCompleteCallback) {\r\n    this.allCompletedCallback = callback;\r\n  }\r\n\r\n  public add(loadItem: LoadItem) {\r\n    loadItem.batch = this;\r\n    this.curCount++;\r\n    this.totalCount++;\r\n  }\r\n\r\n  public remove(loadItem: LoadItem, error: Error, resource: any) {\r\n    this.curCount--;\r\n    if (!error) {\r\n      if (!this.loadedResource) {\r\n        this.loadedResource = {};\r\n      }\r\n      this.loadedResource[loadItem.key()] = resource;\r\n    } else {\r\n      if (!this.error) {\r\n        this.error = error;\r\n      }\r\n    }\r\n\r\n    if (this.curCount <= 0) {\r\n      if (this.allCompletedCallback) {\r\n        if (this.totalCount < 2) {\r\n          if (!this.error) {\r\n            this.allCompletedCallback(this.error, this.loadedResource[SINGLE_BATCH_KEY]);\r\n          } else {\r\n            this.allCompletedCallback(this.error, null);\r\n          }\r\n        } else {\r\n          this.allCompletedCallback(this.error, this.loadedResource);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}