{"version":3,"sources":["ShareManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\common","sourcesContent":["import { PlayerShareGameC2S, PlayerWatchAdC2S, PlayerDoubleC2S } from \"./net/proto/mods/ProtoSectionPlayer\";\r\nimport NetUtil from \"./net/NetUtil\";\r\nimport { DYNotify } from \"../../dyGame/DYNotify\";\r\nimport { Message } from \"./Message\";\r\nimport GamePersist from \"./persist/GamePersist\";\r\nimport SocialManager from \"./social/SocialManager\";\r\nimport { SignInSignC2S } from \"./net/proto/mods/ProtoSectionSignIn\";\r\n\r\nexport class ShareManager {\r\n    private static _instance: ShareManager;\r\n\r\n    public static get Instance(): ShareManager {\r\n        if (ShareManager._instance == null) {\r\n            ShareManager._instance = new ShareManager();\r\n            DYNotify.regObserver(Message.OnShow, ShareManager._instance.onNotify, ShareManager._instance);\r\n\r\n        }\r\n        return ShareManager._instance;\r\n    }\r\n\r\n    shareType;\r\n    param;\r\n\r\n    share(type, param?) {\r\n        this.shareType = type;\r\n        this.param = param;\r\n        const flauntParam = SocialManager.INSTANCE.makeFlauntParam();\r\n        window['Partner'].doFlaunt(flauntParam, () => {\r\n\r\n        });\r\n    }\r\n\r\n    private onNotify(target, tag, param) {\r\n        var self = target;\r\n        if (tag == Message.OnShow) {\r\n            self.onShare(self);\r\n        }\r\n    }\r\n\r\n    // 根据分享类型发送不同请求\r\n    notifyByShareType() {\r\n        switch (this.shareType) {\r\n            case 1:\r\n                this.notifyShareGetEnergy();\r\n                break;\r\n            case 3:\r\n                this.notifyShareGetProp();\r\n                break;\r\n            case 4:\r\n                this.notifyShareGetCoin();\r\n                break;\r\n            case 5:\r\n                this.notifyShareAddStep();\r\n                break;\r\n            case 6:\r\n                this.notifySign(this.param);\r\n                break;\r\n            case 7:\r\n                this.notifyDoubleCoin();\r\n                break;\r\n        }\r\n    }\r\n\r\n    // 分享回调\r\n    onShare(self) {\r\n        if (!window['Partner'].startFlauntTime) {\r\n            return;\r\n        }\r\n        let success = false;\r\n        let duration = Date.now() - window['Partner'].startFlauntTime;\r\n        if (duration >= 5000) {\r\n            success = true;\r\n        } else if (duration > 3000) {\r\n            success = (Math.random() > 0.3 ? true : false);\r\n        } else {\r\n            success = (Math.random() > 0.9 ? true : false);\r\n        }\r\n        if (window['Partner'].PARTNER_NAME == \"qqplay\") {\r\n            success = true;\r\n        }\r\n        if (success) {\r\n            self.notifyByShareType();\r\n        } else {\r\n            let msg = (Math.random() > 0.67 ? '分享失败' : (Math.random() > 0.33 ? '请分享到群' : '请不要过多打扰同一个群'));\r\n            GamePersist.INSTANCE.toast(msg);\r\n        }\r\n        window['Partner'].startFlauntTime = null;\r\n    }\r\n\r\n    // 发送签到请求\r\n    notifySign(param) {\r\n        let signInSign = new SignInSignC2S();\r\n        signInSign.slot = param.slotIndex;\r\n        if (param.isDouble === 1) {\r\n            signInSign.double = 1;\r\n        } else {\r\n            signInSign.double = 0;\r\n        }\r\n        NetUtil.SendMsg(signInSign);\r\n    }\r\n\r\n    // 分享获得体力\r\n    notifyShareGetEnergy() {\r\n        var playerShareGameC2S = new PlayerShareGameC2S();\r\n        playerShareGameC2S.reason = 1;\r\n        NetUtil.SendMsg(playerShareGameC2S);\r\n    }\r\n    // 分享获得道具次数\r\n    notifyShareGetProp() {\r\n        var playerShareGameC2S = new PlayerShareGameC2S();\r\n        playerShareGameC2S.reason = 3;\r\n        NetUtil.SendMsg(playerShareGameC2S);\r\n    }\r\n\r\n    // 分享增加金币次数\r\n    notifyShareGetCoin() {\r\n        var playerShareGameC2S = new PlayerShareGameC2S();\r\n        playerShareGameC2S.reason = 4;\r\n        NetUtil.SendMsg(playerShareGameC2S);\r\n    }\r\n\r\n    // 分享增加步数次数\r\n    notifyShareAddStep() {\r\n        var playerShareGameC2S = new PlayerShareGameC2S();\r\n        playerShareGameC2S.reason = 5;\r\n        NetUtil.SendMsg(playerShareGameC2S);\r\n    }\r\n\r\n    // 发送获取双倍消息\r\n    notifyDoubleCoin() {\r\n        let playerDouble = new PlayerDoubleC2S();\r\n        playerDouble.reason = 1;\r\n        NetUtil.SendMsg(playerDouble);\r\n    }\r\n\r\n\r\n\r\n    // 观看广告获得道具\r\n    notifyWatchAdGetProp() {\r\n        var msg = new PlayerWatchAdC2S();\r\n        msg.reason = 1;\r\n        NetUtil.SendMsg(msg);\r\n    }\r\n\r\n    // 观看广告增加步数次数\r\n    notifyWatchAdAddStep() {\r\n        var msg = new PlayerWatchAdC2S();\r\n        msg.reason = 2;\r\n        NetUtil.SendMsg(msg);\r\n    }\r\n\r\n    // 观看广告获得金币\r\n    notifyWatchAdGetCoin() {\r\n        var msg = new PlayerWatchAdC2S();\r\n        msg.reason = 3;\r\n        NetUtil.SendMsg(msg);\r\n    }\r\n\r\n    // 观看广告获得双倍\r\n    notifyWatchAdDoubleCoin() {\r\n        var msg = new PlayerWatchAdC2S();\r\n        msg.reason = 3;\r\n        NetUtil.SendMsg(msg);\r\n    }\r\n}"]}