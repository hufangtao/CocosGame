{"version":3,"sources":["SocialManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\common\\social","sourcesContent":["import * as Modules from \"../../module/Modules\";\r\nimport GamePersist from \"../persist/GamePersist\";\r\nimport * as Misc from \"../Misc\";\r\nimport { PlayerShareGameC2S } from \"../net/proto/mods/ProtoSectionPlayer\";\r\nimport NetUtil from \"../net/NetUtil\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class SocialManager {\r\n  public static get INSTANCE(): SocialManager {\r\n    if (!SocialManager.singleInstance) {\r\n      SocialManager.singleInstance = new SocialManager();\r\n      SocialManager.singleInstance.init();\r\n    }\r\n    return SocialManager.singleInstance;\r\n  }\r\n\r\n  private static singleInstance: SocialManager;\r\n\r\n  // 设置玩家的星数\r\n  public setUserStar(star: number) {\r\n    window['Partner'].setUserStar(star);\r\n  }\r\n\r\n  // 构造邀请的参数\r\n  public makeInviteParam(serverParam: string): any {\r\n    if (window['Partner'].PARTNER_NAME === \"Dev\") {\r\n      return serverParam;\r\n    } else if (window['Partner'].PARTNER_NAME === \"Wechat\") {\r\n      const sysShare = Misc.randFlauntShare();\r\n      const playerId = Modules.Home.DataPlayer.MyId;\r\n      const imgUrl = window['Partner'].shareImgUrl(sysShare.img);\r\n      return {\r\n        imageUrl: imgUrl,\r\n        query: \"inviter=\" + serverParam + \"&from=\" + playerId + \"&time=\" + GamePersist.INSTANCE.ServerTime,\r\n        title: sysShare.title,\r\n      };\r\n    } else if (window['Partner'].PARTNER_NAME === \"qqplay\") {\r\n        const sysShare = Misc.randFlauntShare();\r\n        const playerId = Modules.Home.DataPlayer.MyId;\r\n        const imgUrl = window['Partner'].shareImgUrl(sysShare.img);\r\n        return {\r\n            title: sysShare.title,\r\n            summary: sysShare.title,\r\n            isToFriend: true,\r\n            qqImgUrl: \"http://dsqpk-cdn.dayukeji.com/fruit/flaunt_pics/\" + imgUrl,\r\n            extendInfo: \"inviter=\" + serverParam + \"&from=\" + playerId + \"&time=\" + GamePersist.INSTANCE.ServerTime,\r\n        };\r\n    }\r\n  }\r\n\r\n  // 构造炫耀的参数\r\n  public makeFlauntParam(): any {\r\n    const sysShare = Misc.randFlauntShare();\r\n    const playerId = Modules.Home.DataPlayer.MyId;\r\n    const imgUrl = window['Partner'].shareImgUrl(sysShare.img);\r\n    return {\r\n      imageUrl: imgUrl,\r\n      query: \"from=\" + playerId + \"&time=\" + GamePersist.INSTANCE.ServerTime,\r\n      title: sysShare.title,\r\n    };\r\n  }\r\n\r\n  // 构造主动分享的参数\r\n  public makeManualParam(): any {\r\n    const sysShare = Misc.randManualShare();\r\n    const playerId = Modules.Home.DataPlayer.MyId;\r\n    const imgUrl = window['Partner'].shareImgUrl(sysShare.img);\r\n    return {\r\n      imageUrl: imgUrl,\r\n      query: \"from=\" + playerId + \"&time=\" + GamePersist.INSTANCE.ServerTime,\r\n      title: sysShare.title,\r\n    };\r\n  }\r\n\r\n\r\n  public init() {\r\n    const self = this;\r\n    window['Partner'].showShareMenu();\r\n    window['Partner'].registerShareAppCallback(function () {\r\n      return self.onShareApp();\r\n    }, function () {\r\n      var playerShareGameC2S = new PlayerShareGameC2S();\r\n      playerShareGameC2S.reason = 1;\r\n      NetUtil.SendMsg(playerShareGameC2S);\r\n    });\r\n  }\r\n\r\n  private onShareApp() {\r\n    const sysShare = Misc.randFlauntShare();\r\n    const imgUrl = window['Partner'].shareImgUrl(sysShare.img);\r\n    const playerId = Modules.Home.DataPlayer.MyId;\r\n    return {\r\n      imageUrl: imgUrl,\r\n      query: \"from=\" + playerId + \"&time=\" + GamePersist.INSTANCE.ServerTime,\r\n      title: sysShare.title,\r\n    };\r\n  }\r\n}\r\n"]}