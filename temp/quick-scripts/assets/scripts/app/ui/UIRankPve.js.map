{"version":3,"sources":["UIRankPve.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\ui","sourcesContent":["import { ValueKey } from \"../common/Defines\";\r\nimport { RankPveRankC2S } from \"../common/net/proto/mods/ProtoSectionRank\";\r\nimport GamePersist from \"../common/persist/GamePersist\";\r\nimport NetUtil from \"../common/net/NetUtil\";\r\nimport { Home, Play } from \"../module/Modules\";\r\nimport { DYNotify } from \"../../dyGame/DYNotify\";\r\nimport { Message } from \"../common/Message\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RankPve extends cc.Component {\r\n    @property(cc.Prefab)\r\n    private pListItem: cc.Prefab = null;                // 排行item\r\n\r\n    @property(cc.Node)\r\n    private nodeGlobalContainer: cc.Node = null;   // 全服排行榜容器\r\n\r\n    @property(cc.Node)\r\n    private pGlobalRankList: cc.Node = null;  // 全服排行list面板\r\n\r\n    @property(cc.Node)\r\n    private nodFriendToggle: cc.Node = null;\r\n    @property(cc.Node)\r\n    private nodGlobalToggle: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    private pInRankNode: cc.Node = null;     // 在排名中\r\n\r\n    @property(cc.Label)\r\n    private textGlobalRankPos: cc.Label = null; // 上榜榜次\r\n\r\n    @property(cc.Label)\r\n    private textOutsideGlobalRank: cc.Label = null; // 未上榜提示\r\n\r\n    @property(cc.Label)\r\n    private pNobodyLabel: cc.Label = null;      // 没有内容时的提示\r\n\r\n    isShowFriendRank;\r\n\r\n    onLoad() {\r\n        this.nodFriendToggle.on('click', this.onFriendRank, this);\r\n        this.nodGlobalToggle.on('click', this.onGlobalRank, this);\r\n    }\r\n    onEnable() {\r\n        DYNotify.regObserver(Message.RANK_RESULT, this.onNotify, this);\r\n        this.nodGlobalToggle.getComponent(cc.Toggle).isChecked = true;\r\n        this.nodFriendToggle.getComponent(cc.Toggle).isChecked = false;\r\n        this.showRank();\r\n        this.pNobodyLabel.node.active = false;\r\n    }\r\n\r\n    onFriendRank() {\r\n        GamePersist.INSTANCE.btnAudio_1();\r\n        // 是否支持好友排行榜\r\n        if (!window['Partner'].supportSocialFriend()) {\r\n            this.showNotSupport();\r\n            return;\r\n        }\r\n        window['Partner'].postMsg(1, { valuekey: ValueKey.levelScore });\r\n        this.node.getChildByName('nodFriendRank').active = true;\r\n        this.nodeGlobalContainer.active = false;\r\n        this.node.getChildByName('nodNotSupport').active = false;\r\n        this.node.getChildByName('nobodyLabel').active = false;\r\n        this.isShowFriendRank = true;\r\n    }\r\n    onGlobalRank() {\r\n        GamePersist.INSTANCE.btnAudio_1();\r\n        this.nodeGlobalContainer.active = true;\r\n        this.node.getChildByName('nodNotSupport').active = false;\r\n        this.node.getChildByName('nodFriendRank').active = false;\r\n        this.isShowFriendRank = false;\r\n    }\r\n\r\n    private onNotify(target, tag, param) {\r\n        var self = target;\r\n        \r\n        if (tag == Message.RANK_RESULT) {\r\n            if (param.level == Play.DataPve.curLevel) {\r\n                Home.PveRank = param;\r\n                self.showGlobalRank();\r\n            }\r\n        }\r\n    }\r\n\r\n    public start() {\r\n\r\n    }\r\n\r\n    onDisable() {\r\n        const pListConetn: cc.Node = cc.find(\"rank_list/view/content\", this.pGlobalRankList);\r\n        pListConetn.destroyAllChildren();\r\n        this.nodeGlobalContainer.active = true;\r\n        this.node.getChildByName('nodFriendRank').active = false;\r\n        this.isShowFriendRank = false;\r\n        DYNotify.removeAllObservers(this);\r\n    }\r\n\r\n    showRank() {\r\n        const rankDataReq = new RankPveRankC2S();\r\n        rankDataReq.level = Play.DataPve.curLevel;\r\n        rankDataReq.posStart = 1;\r\n        rankDataReq.posEnd = 10;\r\n        NetUtil.SendMsg(rankDataReq);\r\n    }\r\n    // 查看全服排行\r\n    public showGlobalRank(): void {\r\n        this.nodeGlobalContainer.active = true;\r\n        this.node.getChildByName('nodNotSupport').active = false;\r\n\r\n        const pListConetn: cc.Node = cc.find(\"rank_list/view/content\", this.pGlobalRankList);\r\n        pListConetn.destroyAllChildren();\r\n\r\n        cc.log(Home.PveRank.playmates)\r\n\r\n        // 没有玩家时\r\n        const vecRankData = Home.PveRank.playmates;\r\n        if (!vecRankData || vecRankData.length <= 0) {\r\n            this.showNobody();\r\n            return;\r\n        }\r\n\r\n        this.fillGlobalRank();\r\n    }\r\n\r\n    private fillGlobalRank() {\r\n        const rankList = Home.PveRank.playmates;\r\n        this.getComponent('ListView').showRank(rankList);\r\n    }\r\n\r\n\r\n    // 没有人上榜\r\n    private showNobody() {\r\n        this.nodeGlobalContainer.active = false;\r\n        this.node.getChildByName('nodNotSupport').active = false;\r\n        this.node.getChildByName('nobodyLabel').active = true;\r\n    }\r\n    private showNotSupport() {\r\n        this.nodeGlobalContainer.active = false;\r\n        this.node.getChildByName('nodNotSupport').active = true;\r\n    }\r\n}\r\n"]}