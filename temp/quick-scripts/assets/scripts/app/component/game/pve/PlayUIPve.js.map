{"version":3,"sources":["PlayUIPve.ts"],"names":[],"mappings":";;;;;AAAA,uCAAkC;AAClC,mDAA8C;AAC9C,oFAAoG;AACpG,mDAAqD;AACrD,mEAA8D;AAE9D,kCAA6B;AAC7B,8CAAyC;AACzC,uDAAkD;AAClD,wCAAmC;AACnC,uCAAkC;AAClC,mDAAmD;AAEnD,sEAAiE;AACjE,iDAAgD;AAEhD,mDAAkD;AAClD,4CAA2C;AAC3C,+CAA0C;AAC1C,wDAAuD;AAEvD,iDAAmD;AAE7C,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAG5C;IAAuC,6BAAM;IAD7C;QAAA,qEAqPC;QAlPG,qBAAe,GAAY,IAAI,CAAC;QAEhC,iBAAW,GAAmB,IAAI,CAAC;QAGnC,mBAAa,GAAY,IAAI,CAAC;QAE9B,eAAS,GAAiB,IAAI,CAAC;QAG/B,WAAK,GAAU,IAAI,CAAC;QAEpB,cAAQ,GAAG,IAAI,CAAC;QAGhB,YAAM,GAAG,KAAK,CAAC;QACf,iBAAW,GAAG,KAAK,CAAC;QAgMpB,kBAAY,GAAG,KAAK,CAAC;;IAkCzB,CAAC;IAhOgB,0BAAM,GAAnB;;;gBACI,iBAAM,MAAM,WAAE,CAAC;gBACf,kBAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACzB,qBAAW,CAAC,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC;gBACtC,cAAI,CAAC,SAAS,GAAG,uBAAU,CAAC,GAAG,CAAC;gBAEhC,mBAAQ,CAAC,WAAW,CAAC,iBAAO,CAAC,aAAa,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;gBACjE,mBAAQ,CAAC,WAAW,CAAC,iBAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;gBAC5D,mBAAQ,CAAC,WAAW,CAAC,iBAAO,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;gBAE7D,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC1B,qBAAqB;gBACrB,eAAM,CAAC,OAAO,CAAC,YAAY,EAAC,UAAC,IAAI,IAAI,CAAC,CAAC,CAAA;gBACvC,MAAM,CAAC,SAAS,CAAC,CAAC,YAAY,EAAE,CAAC;;;;KACpC;IAED,8BAAU,GAAV;QACI,IAAI,MAAM,CAAC,SAAS,CAAC,CAAC,SAAS,EAAE,EAAE;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,UAAU,EAAE,CAAC;SAClC;IACL,CAAC;IACD,8BAAU,GAAV;QACI,IAAI,MAAM,CAAC,SAAS,CAAC,CAAC,SAAS,EAAE,EAAE;YAC/B,MAAM,CAAC,SAAS,CAAC,CAAC,UAAU,EAAE,CAAC;SAClC;IACL,CAAC;IACM,yBAAK,GAAZ;QACI,iBAAM,KAAK,WAAE,CAAC;QAEd,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QAEzB,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;IAExB,CAAC;IACD,kCAAc,GAAd;QACI,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IACM,0BAAM,GAAb;QACI,OAAO,WAAW,CAAC;IACvB,CAAC;IAEK,wBAAI,GAAV;;;;gBACI,IAAI,CAAC,SAAS,EAAE,CAAC;gBACjB,kBAAQ,CAAC,QAAQ,EAAE,CAAC;gBACpB,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;oBACzB,qBAAW,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC;oBACtC,KAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;gBAC/B,CAAC,CAAC,CAAC;;;;KACN;IAED,6BAAS,GAAT;QACI,cAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;QAChD,cAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;QAChD,cAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;QAC9C,cAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC;QACtD,cAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;QAC9C,cAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC;QACxD,cAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC;QACxD,cAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;QAC9C,cAAI,CAAC,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC;QACxD,cAAI,CAAC,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;IACtD,CAAC;IAED,6BAAS,GAAT;QACI,IAAI,KAAK,GAAG,cAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC;QACtC,IAAI,SAAS,GAAG,cAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,KAAK,CAAC,CAAC;QAClD,IAAI,CAAC,SAAS,EAAE;YACZ,qBAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;YAC5C,OAAM;SACT;QACD,IAAI,QAAQ,GAAG,IAAI,kCAAe,EAAE,CAAC;QACrC,qBAAW,CAAC,QAAQ,CAAC,YAAY,GAAG,CAAC,CAAC;QACtC,iBAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAC9B,CAAC;IAED,4BAAQ,GAAR;QACI,IAAI,KAAK,GAAG,cAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC;QACtC,IAAI,KAAK,IAAI,cAAI,CAAC,UAAU,CAAC,KAAK,GAAG,CAAC,EAAE;YACpC,cAAI,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;YAC9B,cAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,KAAK,CAAC;YAC9B,qBAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;YAC3C,IAAI,CAAC,UAAU,EAAE,CAAC;SACrB;IACL,CAAC;IAED,4BAAQ,GAAR;QACI,IAAI,gBAAgB,GAAG,IAAI,mCAAgB,EAAE,CAAC;QAC9C,gBAAgB,CAAC,KAAK,GAAG,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;QAC/C,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC;QAC5B,gBAAgB,CAAC,QAAQ,GAAG,cAAI,CAAC,OAAO,CAAC,KAAK,CAAC;QAC/C,gBAAgB,CAAC,eAAe,GAAG,cAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;QACjI,MAAM,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,QAAQ,EAAE,kBAAQ,CAAC,UAAU,EAAE,KAAK,EAAE,cAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC,CAAC;QAE3F,YAAY;QACZ,uBAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;QACpJ,iBAAO,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QAClC,mBAAQ,CAAC,IAAI,CAAC,iBAAO,CAAC,SAAS,CAAC,CAAA;IACpC,CAAC;IAED,6BAAS,GAAT;QACI,cAAI,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;QAC9B,qBAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QAC3C,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IAEM,+BAAW,GAAlB,UAAmB,KAA0B;QACzC,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;QAC1B,QAAQ,MAAM,CAAC,IAAI,EAAE;YACjB,KAAK,cAAc;gBACf,qBAAW,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;gBAClC,IAAI,CAAC,SAAS,EAAE,CAAC;gBACjB,MAAM;YACV,KAAK,aAAa;gBACd,qBAAW,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;gBAClC,IAAI,QAAQ,GAAG,IAAI,kCAAe,EAAE,CAAC;gBACrC,qBAAW,CAAC,QAAQ,CAAC,YAAY,GAAG,CAAC,CAAC;gBACtC,iBAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC1B,oBAAoB;gBACpB,MAAM;YACV,KAAK,SAAS;gBACV,qBAAW,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;gBAClC,qCAAqC;gBACrC,IAAI,CAAC,SAAS,EAAE,CAAC;gBACjB,MAAM;SACb;IACL,CAAC;IAEM,6BAAS,GAAhB;QACI,MAAM,CAAC,SAAS,CAAC,CAAC,UAAU,EAAE,CAAC;IACnC,CAAC;IAED,6BAAS,GAAT;QACI,eAAM,CAAC,MAAM,CAAC,SAAS,EAAE,UAAC,IAAI;YAC1B,qBAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,EAAE;YAEnE,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAA;QACF,cAAI,CAAC,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC;IACnC,CAAC;IAEa,4BAAQ,GAAtB,UAAuB,MAAM,EAAE,GAAG,EAAE,KAAK;;;;gBACjC,IAAI,GAAG,MAAM,CAAC;gBAClB,IAAI,GAAG,IAAI,iBAAO,CAAC,QAAQ,EAAE;oBACzB,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;iBACrB;qBAAM,IAAI,GAAG,IAAI,iBAAO,CAAC,SAAS,EAAE;oBACjC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;iBACrB;qBAAM,IAAI,GAAG,IAAI,iBAAO,CAAC,aAAa,EAAE;oBACrC,IAAG,KAAK,CAAC,MAAM,IAAI,CAAC,EAAC;wBACjB,sBAAO;qBACV;oBACD,IAAI,KAAK,CAAC,OAAO,KAAK,CAAC,EAAE;wBACrB,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;qBAC3B;iBACJ;;;;KACJ;IAED,QAAQ;IACR,6BAAS,GAAT;QACI,eAAM,CAAC,OAAO,CAAC,WAAW,EAAE,cAAQ,CAAC,CAAC,CAAA;QACtC,IAAI,cAAI,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,GAAG,CAAC,EAAE;YACjC,kBAAQ,CAAC,QAAQ,CAAC,aAAa,GAAG,KAAK,CAAC;YACxC,cAAI,CAAC,OAAO,CAAC,UAAU,GAAG,IAAI,CAAC;YAC/B,cAAI,CAAC,OAAO,CAAC,UAAU,GAAG,EAAE,CAAC;YAC7B,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;SACjC;aAAM;YACH,kBAAQ,CAAC,QAAQ,CAAC,aAAa,GAAG,KAAK,CAAC;YACxC,cAAI,CAAC,OAAO,CAAC,UAAU,GAAG,IAAI,CAAC;YAC/B,cAAI,CAAC,OAAO,CAAC,UAAU,GAAG,CAAC,CAAC;YAC5B,IAAI,CAAC,WAAW,CAAC,eAAe,EAAE,CAAC;SACtC;IACL,CAAC;IAED,kCAAc,GAAd;QAAA,iBAcC;QAbG,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,eAAM,CAAC,MAAM,CAAC,YAAY,EAAE,UAAC,IAAI;YAC7B,KAAI,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;YAElD,IAAI,KAAI,CAAC,YAAY,EAAE;gBACnB,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;gBAC3B,IAAI,KAAI,CAAC,SAAS,KAAK,CAAC,EAAE;oBACtB,KAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;iBAC1B;qBAAM;oBACH,KAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;iBACzB;aACJ;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAID,UAAU;IACV,6BAAS,GAAT,UAAU,IAAI;QACV,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;SACV;QACD,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3B,IAAI,IAAI,KAAK,CAAC,EAAE;gBACZ,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;aAC1B;iBAAM;gBACH,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;aACzB;SACJ;aAAM;YACH,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YACzB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;SACzB;IACL,CAAC;IAED,mCAAe,GAAf,UAAgB,IAAI;QAChB,qBAAW,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC;QACpC,eAAM,CAAC,MAAM,CAAC,UAAU,EAAE,UAAC,IAAI;YAC3B,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAC5C,qBAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,CAAC;YACnE,qBAAW,CAAC,QAAQ,CAAC,aAAa,EAAE,CAAC;QACzC,CAAC,CAAC,CAAA;IACN,CAAC;IAED,6BAAS,GAAT;QACI,mBAAQ,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;IACtC,CAAC;IAhPD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;sDACc;IAEhC;QADC,QAAQ,CAAC,wBAAc,CAAC;kDACU;IAGnC;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;oDACY;IAE9B;QADC,QAAQ,CAAC,sBAAY,CAAC;gDACQ;IAG/B;QADC,QAAQ,CAAC,eAAK,CAAC;4CACI;IAZH,SAAS;QAD7B,OAAO;OACa,SAAS,CAoP7B;IAAD,gBAAC;CApPD,AAoPC,CApPsC,gBAAM,GAoP5C;kBApPoB,SAAS","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\component\\game\\pve","sourcesContent":["import BaseUI from \"../../BaseUI\";\r\nimport PanelHeaderPve from \"./PanelHeaderPve\";\r\nimport { PlayPveFinishC2S, PlayStartPveC2S } from \"../../../common/net/proto/mods/ProtoSectionPlay\";\r\nimport { Home, Play } from \"../../../module/Modules\";\r\nimport GamePersist from \"../../../common/persist/GamePersist\";\r\nimport DYAudio from \"../../../../dyGame/DYAudio\";\r\nimport Audio from \"../Audio\";\r\nimport PlayManager from \"../PlayManager\";\r\nimport NetUtil from \"../../../common/net/NetUtil\";\r\nimport NodePool from \"../NodePool\";\r\nimport StateMgr from \"./StateMgr\";\r\nimport { ValueKey } from \"../../../common/Defines\";\r\nimport { PlayerWatchAdC2S } from \"../../../common/net/proto/mods/ProtoSectionPlayer\";\r\nimport SocialManager from \"../../../common/social/SocialManager\";\r\nimport { UIFunc } from \"../../../common/UIFunc\";\r\nimport UIScorePve from \"../../../ui/UIScorePve\";\r\nimport { Message } from \"../../../common/Message\";\r\nimport { GAME_MODEL } from \"../PlayDefine\";\r\nimport LayerGamePve from \"./LayerGamePve\";\r\nimport { DYNotify } from \"../../../../dyGame/DYNotify\";\r\nimport HomeModule from \"../../page/home/HomeModule\";\r\nimport * as Modules from \"../../../module/Modules\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PlayUIPve extends BaseUI {\r\n    @property(cc.Node)\r\n    panelHeaderNode: cc.Node = null;\r\n    @property(PanelHeaderPve)\r\n    panelHeader: PanelHeaderPve = null;\r\n\r\n    @property(cc.Node)\r\n    layerGameNode: cc.Node = null;\r\n    @property(LayerGamePve)\r\n    layerGame: LayerGamePve = null;\r\n\r\n    @property(Audio)\r\n    Audio: Audio = null;\r\n\r\n    dataPlay = null;\r\n\r\n    UIScorePve: UIScorePve;\r\n    isOver = false;\r\n    isBonusOver = false;\r\n\r\n    public async onLoad() {\r\n        super.onLoad();\r\n        StateMgr.INSTANCE.init();\r\n        PlayManager.INSTANCE.PlayUIPve = this;\r\n        Play.GameModel = GAME_MODEL.PVE;\r\n\r\n        DYNotify.regObserver(Message.GET_SHARE_CNT, this.onNotify, this);\r\n        DYNotify.regObserver(Message.GAME_WIN, this.onNotify, this);\r\n        DYNotify.regObserver(Message.GAME_LOST, this.onNotify, this);\r\n\r\n        this.layerGame.init(this);\r\n        // this.showOverAd();\r\n        UIFunc.closeUI('UIScorePve',(node)=>{})\r\n        window['Partner'].hideGameClub();\r\n    }\r\n\r\n    showOverAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            window['Partner'].showOverAd();\r\n        }\r\n    }\r\n    hideOverAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            window['Partner'].hideOverAd();\r\n        }\r\n    }\r\n    public start() {\r\n        super.start();\r\n\r\n        this.layerGameNode.active = true;\r\n        this.isOver = false;\r\n        this.isBonusOver = false;\r\n\r\n        this.Audio.playBg();\r\n\r\n    }\r\n    onLoadSceneEnd() {\r\n        this.init();\r\n    }\r\n    public uiName(): string {\r\n        return \"PlayUIPve\";\r\n    }\r\n\r\n    async init() {\r\n        this.setPrefab();\r\n        NodePool.initPool();\r\n        this.layerGame.loadLevelData(()=>{\r\n            GamePersist.INSTANCE.onLoadSceneEnd();\r\n            this.layerGame.gameBegin();\r\n        });\r\n    }\r\n\r\n    setPrefab() {\r\n        Play.DataPve.pfbScore = this.layerGame.pfbScore;\r\n        Play.DataPve.pfbBlock = this.layerGame.pfbBlock;\r\n        Play.DataPve.pfbBomb = this.layerGame.pfbBomb;\r\n        Play.DataPve.pfbObstacle = this.layerGame.pfbObstacle;\r\n        Play.DataPve.pfbWall = this.layerGame.pfbWall;\r\n        Play.DataPve.pfbTableware = this.layerGame.pfbTableware;\r\n        Play.DataPve.pfbTransport = this.layerGame.pfbTransport;\r\n        Play.DataPve.pfbGate = this.layerGame.pfbGate;\r\n        Play.DataPve.pfbBonusBall = this.layerGame.pfbBonusBall;\r\n        Play.DataPve.pfbTileBg = this.layerGame.pfbTileBg;\r\n    }\r\n\r\n    nextLevel() {\r\n        let level = Play.DataPve.curLevel + 1;\r\n        let levelData = Play.LevelDatas['level_' + level];\r\n        if (!levelData) {\r\n            GamePersist.INSTANCE.toast('程序员小哥哥还在加班开发中');\r\n            return\r\n        }\r\n        var startPve = new PlayStartPveC2S();\r\n        PlayManager.INSTANCE.PveEnterType = 1;\r\n        NetUtil.SendMsg(startPve);\r\n    }\r\n\r\n    loadGame() {\r\n        let level = Play.DataPve.curLevel + 1;\r\n        if (level <= Home.DataPlayer.Level + 1) {\r\n            Play.DataPve.clearFreeNodes();\r\n            Play.DataPve.curLevel = level;\r\n            GamePersist.INSTANCE.loadScene('pve_game');\r\n            this.hideOverAd();\r\n        }\r\n    }\r\n\r\n    loseGame() {\r\n        let playPveFinishC2S = new PlayPveFinishC2S();\r\n        playPveFinishC2S.pveId = Play.DataPve.curLevel;\r\n        playPveFinishC2S.pveWin = 2;\r\n        playPveFinishC2S.pveScore = Play.DataPve.score;\r\n        playPveFinishC2S.remainStepsTime = Play.DataPve.saveStep > Play.DataPve.saveTime ? Play.DataPve.saveStep : Play.DataPve.saveTime;\r\n        window['Partner'].postMsg(4, { valuekey: ValueKey.levelScore, score: Play.DataPve.score });\r\n\r\n        // 更新社交需要的数据\r\n        SocialManager.INSTANCE.setUserStar(Modules.Home.DataPlayer.FortuneStar + Modules.Home.DataPlayer.PlayCntWin / Modules.Home.DataPlayer.PlayCntTotal);\r\n        NetUtil.SendMsg(playPveFinishC2S);\r\n        DYNotify.post(Message.GAME_LOST)\r\n    }\r\n\r\n    playAgain() {\r\n        Play.DataPve.clearFreeNodes();\r\n        GamePersist.INSTANCE.loadScene('pve_game');\r\n        this.hideOverAd();\r\n    }\r\n\r\n    public btnListener(event: cc.Event.EventTouch) {\r\n        var target = event.target;\r\n        switch (target.name) {\r\n            case 'btnNextLevel':\r\n                GamePersist.INSTANCE.btnAudio_1();\r\n                this.nextLevel();\r\n                break;\r\n            case 'btnContinue':\r\n                GamePersist.INSTANCE.btnAudio_1();\r\n                var startPve = new PlayStartPveC2S();\r\n                PlayManager.INSTANCE.PveEnterType = 2;\r\n                NetUtil.SendMsg(startPve);\r\n                // this.playAgain();\r\n                break;\r\n            case 'btnBack':\r\n                GamePersist.INSTANCE.btnAudio_1();\r\n                // GamePersist.INSTANCE.blockInput();\r\n                this.pauseGame();\r\n                break;\r\n        }\r\n    }\r\n\r\n    public onAppHide() {\r\n        window['Partner'].hideOverAd();\r\n    }\r\n\r\n    pauseGame() {\r\n        UIFunc.openUI('UIQuick', (node) => {\r\n            GamePersist.INSTANCE.panelPopUp(node.getChildByName('nodContent'), () => {\r\n\r\n            });\r\n        })\r\n        Play.DataPve.gameBegan = false;\r\n    }\r\n\r\n    private async onNotify(target, tag, param) {\r\n        var self = target;\r\n        if (tag == Message.GAME_WIN) {\r\n            self.showScore(1);\r\n        } else if (tag == Message.GAME_LOST) {\r\n            self.showScore(0);\r\n        } else if (tag == Message.GET_SHARE_CNT) {\r\n            if(param.reason != 1){\r\n                return;\r\n            }\r\n            if (param.success === 1) {\r\n                self.showEnergyEmpty(2);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 看广告回调\r\n    onWatchAd() {\r\n        UIFunc.closeUI('UIAddStep', () => { })\r\n        if (Play.DataPve.levelData.time > 0) {\r\n            StateMgr.INSTANCE.isStopOperate = false;\r\n            Play.DataPve.hadAddStep = true;\r\n            Play.DataPve.remainTime = 10;\r\n            this.panelHeader.updateTime();\r\n        } else {\r\n            StateMgr.INSTANCE.isStopOperate = false;\r\n            Play.DataPve.hadAddStep = true;\r\n            Play.DataPve.remainStep = 5;\r\n            this.panelHeader.updateLabelStep();\r\n        }\r\n    }\r\n\r\n    loadUIScorePve() {\r\n        this.hideOverAd();\r\n        UIFunc.openUI('UIScorePve', (node) => {\r\n            this.UIScorePve = node.getComponent('UIScorePve');\r\n\r\n            if (this.canshowScore) {\r\n                this.UIScorePve.init(this);\r\n                if (this.scoreType === 0) {\r\n                    this.UIScorePve.lose();\r\n                } else {\r\n                    this.UIScorePve.win();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    canshowScore = false;\r\n    scoreType;\r\n    // 0失败,1成功\r\n    showScore(type) {\r\n        if (this.canshowScore) {\r\n            return;\r\n        }\r\n        if (this.UIScorePve) {\r\n            this.UIScorePve.init(this);\r\n            if (type === 0) {\r\n                this.UIScorePve.lose();\r\n            } else {\r\n                this.UIScorePve.win();\r\n            }\r\n        } else {\r\n            this.loadUIScorePve();\r\n            this.canshowScore = true;\r\n            this.scoreType = type;\r\n        }\r\n    }\r\n\r\n    showEnergyEmpty(mode) {\r\n        GamePersist.INSTANCE.ForceWaiting();\r\n        UIFunc.openUI('UIEnergy', (node) => {\r\n            node.getComponent('UIEnergy').setMode(mode);\r\n            GamePersist.INSTANCE.panelPopUp(node.getChildByName('nodContent'));\r\n            GamePersist.INSTANCE.CancelWaiting();\r\n        })\r\n    }\r\n\r\n    onDestroy() {\r\n        DYNotify.removeAllObservers(this);\r\n    }\r\n\r\n}"]}