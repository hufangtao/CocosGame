{"version":3,"sources":["Prop.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\app\\component\\page\\home","sourcesContent":["import GamePersist from \"../../../common/persist/GamePersist\";\r\nimport { Home } from \"../../../module/Modules\";\r\nimport HomeUI from \"./HomeUI\";\r\nimport { UIFunc } from \"../../../common/UIFunc\";\r\nimport { Message } from \"../../../common/Message\";\r\nimport { DYNotify } from \"../../../../dyGame/DYNotify\";\r\nimport { ShareManager } from \"../../../common/ShareManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Prop extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    public nodBuffSlot: cc.Node = null;\r\n    @property(cc.Node)\r\n    public pointer: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    public adFrame: cc.Node = null;\r\n    // 四个道具位置\r\n\r\n    homeUI: HomeUI;\r\n    onLoad() {\r\n        DYNotify.regObserver(Message.EVENT_MODULE_PLAYER_PRIZE_INIT, this.onNotify, this);\r\n        DYNotify.regObserver(Message.GET_SHARE_CNT, this.onNotify, this);\r\n\r\n        this.updateBuff();\r\n        this.initAd();\r\n        this.canLoadUIGetProp = false;\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    showHomeAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            window['Partner'].showHomeAd(() => {\r\n                this.adFrame.active = true;\r\n            });\r\n        }\r\n    }\r\n    hideHomeAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            this.adFrame.active = false;\r\n            window['Partner'].hideHomeAd();\r\n        }\r\n    }\r\n    public onDisable() {\r\n        DYNotify.removeAllObservers(this);\r\n    }\r\n\r\n    init(homeUI: HomeUI) {\r\n        this.homeUI = homeUI;\r\n    }\r\n\r\n    showGuideHand() {\r\n        this.pointer.active = true;\r\n        this.pointer.getComponent(cc.Animation).play(\"aniGuide\");\r\n    }\r\n\r\n\r\n\r\n    initAd() {\r\n        if (window['Partner'].supportAd()) {\r\n            window['Partner'].initVideoAd();\r\n            window['Partner'].initHomeAd((scrWidth, adWidth, adHeight) => {\r\n                let scale = 720 / scrWidth;\r\n                let relAdWidth = scale * adWidth;\r\n                let relAdHeight = scale * adHeight;\r\n                if (!this.adFrame) {\r\n                    return;\r\n                }\r\n                this.adFrame.width = relAdWidth + 42 * scale;\r\n                this.adFrame.height = relAdHeight + 4 * scale;\r\n            });\r\n        }\r\n    }\r\n    hadShowAD = false;\r\n    showAd() {\r\n        if (this.hadShowAD) {\r\n            return;\r\n        }\r\n        this.hadShowAD = true;\r\n        this.canLoadUIGetProp = true;\r\n        DYNotify.regObserver(Message.EVENT_MODULE_PLAYER_PRIZE, this.onNotify, this);\r\n        setTimeout(() => {\r\n            this.hadShowAD = false;\r\n        }, 2000)\r\n        GamePersist.INSTANCE.blockInput();\r\n        if (window['Partner'].supportAd()) {\r\n            window['Partner'].showVideoAd(() => {\r\n                ShareManager.Instance.notifyWatchAdGetProp();\r\n            }, () => {\r\n                this.share();\r\n            });\r\n        } else {\r\n            GamePersist.INSTANCE.toast('不支持广告');\r\n            ShareManager.Instance.notifyWatchAdGetProp();\r\n        }\r\n    }\r\n\r\n\r\n    // 更新buff视图\r\n    updateBuff() {\r\n        for (let i = 0; i < this.nodBuffSlot.children.length; ++i) {\r\n            let num = 0;\r\n            for (let j = 0; j < Home.DataPlayer.PlayerGoodsData.length; ++j) {\r\n                if (Home.DataPlayer.PlayerGoodsData[j].goodsId === i + 1) {\r\n                    num = Home.DataPlayer.PlayerGoodsData[j].goodsNum;\r\n                }\r\n            }\r\n            let label = this.nodBuffSlot.children[i].getChildByName('labCount').getComponent(cc.Label);\r\n            label.string = num + '';\r\n        }\r\n    }\r\n\r\n    // 点击道具，显示说明\r\n    onSlotClick(node) {\r\n        for (let i = 0; i < this.nodBuffSlot.children.length; ++i) {\r\n            if (node === this.nodBuffSlot.children[i]) {\r\n                this.nodBuffSlot.children[i].getChildByName('bk-bubble').active = true;\r\n            } else {\r\n                this.nodBuffSlot.children[i].getChildByName('bk-bubble').active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    canLoadUIGetProp;\r\n    private onNotify(target, tag, param) {\r\n        var self = target;\r\n        if (tag === Message.EVENT_MODULE_PLAYER_PRIZE_INIT) {\r\n            self.updateBuff();\r\n        } else if (tag === Message.EVENT_MODULE_PLAYER_PRIZE) {\r\n            if(cc.director.getScene().name != 'home'){\r\n                return;\r\n            }\r\n            if(!this.canLoadUIGetProp){\r\n                return;\r\n            }\r\n            this.canLoadUIGetProp = false;\r\n            DYNotify.unregObserver(Message.EVENT_MODULE_PLAYER_PRIZE, self.onNotify, self);\r\n            UIFunc.openUI('UIGetProp', (node) => {\r\n                node.getComponent('UIGetProp').homeAchieveProp(self);\r\n            })\r\n        } else if (tag == Message.GET_SHARE_CNT) {\r\n            if (param.reason != 3) {\r\n                return;\r\n            }\r\n            if (param.success == 1) {\r\n                // self.notifyWatchAd();\r\n            } else if (param.success === 0) {\r\n                GamePersist.INSTANCE.toast('获取道具次数已用完，明天再试试');\r\n            }\r\n        }\r\n    }\r\n\r\n    share() {\r\n        GamePersist.INSTANCE.btnAudio_1();\r\n        ShareManager.Instance.share(3);\r\n    }\r\n\r\n    public btnListener(event: cc.Event.EventTouch) {\r\n        this.pointer.active = false;\r\n        var target = event.target;\r\n        this.onSlotClick(null);\r\n        switch (target.name) {\r\n            case 'btnWatchAd':\r\n                this.showAd();\r\n                break;\r\n            case 'btnSlot1':\r\n                this.onSlotClick(target);\r\n                break;\r\n            case 'btnSlot2':\r\n                this.onSlotClick(target);\r\n                break;\r\n            case 'btnSlot3':\r\n                this.onSlotClick(target);\r\n                break;\r\n            case 'btnSlot4':\r\n                this.onSlotClick(target);\r\n                break;\r\n            case 'btnShare':\r\n                this.share();\r\n                break;\r\n            case 'btnBack':\r\n                // this.panelShare.active = false;\r\n                break;\r\n        }\r\n    }\r\n}\r\n"]}